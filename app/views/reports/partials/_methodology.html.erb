<div class="page-break">
  <% methodology = @report_data[:methodology] || [] %>
  <% task_categories = {
    "DNS Record Enumeration" => "Domain & DNS Intelligence",
    "WHOIS Enumeration" => "Domain & DNS Intelligence",
    "ASN Enumeration" => "Network & Infrastructure",
    "Subdomain Enumeration" => "Discovery",
    "Certificate Fetching" => "Discovery",
    "Shared Hosting Check" => "Network & Infrastructure",
    "Assets Search" => "Exposed Assets",
    "Logstealers Search" => "Leak Detection",
    "Search Leaks" => "Leak Detection",
    "Combo Search" => "Leak Detection",
    "Fetch Organization Info" => "Employee Informations",
    "Employees Search" => "Employee Informations",
    "File Scraper" => "Discovery",
    "Process Found Files" => "Analysis & Processing"
  } %>

  <% critical_tasks = ["Logstealers Search", "Search Leaks", "Process Found Files", "Assets Search"] %>

  <% if methodology.any? %>
    <div class="report-section">
      <h3 class="heading-md text-center">Methodology</h3>

      <% grouped = methodology.group_by { |task| task_categories[task[:task]] || "Other" } %>
      <%= render 'reports/partials/methodology_tasks', grouped: grouped, critical_tasks: critical_tasks %>
    </div>
  <% end %>
</div>
